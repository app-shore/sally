@startuml C4_Container
!include https://raw.githubusercontent.com/plantuml-stdlib/C4-PlantUML/master/C4_Container.puml

LAYOUT_WITH_LEGEND()

title Container diagram for SALLY (Route Planning Platform)

Person(dispatcher, "Fleet Dispatcher", "Plans routes, monitors execution, handles updates")
Person(operations, "Operations Manager", "Analyzes route efficiency and system performance")
Person(driver, "Truck Driver", "Follows routes, reports delays")

System_Boundary(restos, "SALLY") {
    Container(web, "Operations Dashboard", "Next.js 15, React 18, TypeScript", "Web UI for route planning, monitoring, and analytics")

    Container(api, "Backend API", "Python 3.11, FastAPI (Async)", "REST API for route planning, dynamic updates, HOS validation, and component services")

    Container(monitoring, "Monitoring Service", "Python Background Service", "Continuously monitors active routes for 14 trigger types (runs every 60s)")

    ContainerDb(db, "Database", "PostgreSQL 16", "Stores route plans, segments, updates, stops, driver/vehicle data")

    ContainerDb(cache, "Cache", "Redis 7", "Caches route calculations, monitoring state, session data")
}

System_Ext(eld, "ELD System", "Electronic Logging Device - HOS data (Phase 3)")
System_Ext(tms, "TMS", "Transportation Management System - Load data (Phase 3)")
System_Ext(telematics, "Telematics", "Vehicle location and fuel (Phase 3)")
System_Ext(traffic, "Traffic API", "Real-time traffic data (Phase 3)")

Rel(dispatcher, web, "Plans routes, adds stops, views status", "HTTPS")
Rel(operations, web, "Monitors performance, views analytics", "HTTPS")
Rel(driver, web, "Views route, reports delays", "HTTPS (Phase 2: Mobile App)")

Rel(web, api, "Route planning, updates, status", "HTTPS/JSON, REST API")
Rel(api, db, "Reads/Writes route plans, segments, updates", "PostgreSQL (Async)")
Rel(api, cache, "Caches calculations, monitoring state", "Redis")

Rel(monitoring, db, "Fetches active routes, driver HOS", "PostgreSQL (Async)")
Rel(monitoring, cache, "Stores monitoring state", "Redis")
Rel(monitoring, api, "Sends triggers for dynamic updates", "Internal")

Rel(api, eld, "Fetches driver HOS data", "HTTPS/REST (Phase 3)")
Rel(api, tms, "Pulls load assignments", "HTTPS/REST (Phase 3)")
Rel(api, telematics, "Gets vehicle location/fuel", "HTTPS/REST (Phase 3)")
Rel(api, traffic, "Checks traffic conditions", "HTTPS/REST (Phase 3)")

note right of api
  **Primary Services:**
  • Route Planning Engine (TSP + HOS simulation)
  • Dynamic Update Handler (re-planning)
  • HOS Rule Engine (compliance validation)
  • REST Optimization Engine (rest decisions)
  • Fuel Stop Engine (fuel optimization)
end note

note right of monitoring
  **14 Trigger Types:**
  • External: Dock delays, traffic, load changes
  • HOS: Approaching limits, violations
  • Vehicle: Fuel low, speed deviations
  • Customer: Appointment changes
end note

@enduml
